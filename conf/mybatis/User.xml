<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User">

	<insert id="saveUser" parameterType="com.aztask.vo.UserVO" useGeneratedKeys="true"	keyProperty="id" keyColumn="id">
	INSERT INTO t_user
	(`name`,
	`contact`,
	`email`,
	`skills`,
	`device_id`)
	VALUES
	(#{name},#{contact},#{email},#{skills},#{device_id});
		<selectKey keyProperty="id" resultType="int" order="AFTER">
			SELECT	LAST_INSERT_ID();
		</selectKey>
	</insert>

  <select id="isUserRegistered" resultType="com.aztask.vo.UserVO">
    select * from t_user where device_id = #{device_id}
  </select>

  <select id="getUserById" resultType="com.aztask.vo.UserVO">
    select * from t_user where user_id = #{id}
  </select>
  
  <select id="getNearbyUsers" resultType="com.aztask.vo.NearbyUser">

	<![CDATA[ SELECT device_id, (6371 * acos (cos ( radians(#{latitude}) ) * cos( radians(tul.latitude ) ) * 
	 		cos( radians(tul.longitude ) - radians(#{longitude}) )+sin ( radians(#{latitude}) ) * sin( radians(tul.latitude) ))) AS distance
	  		FROM t_user_loc tul having distance < 1 order by distance  ]]>
  </select>

  
  
  
</mapper>

